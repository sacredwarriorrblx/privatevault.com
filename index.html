<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrivateVault</title>
    <style>
        :root { --primary: #1a202c; --accent: #3182ce; --bg: #f7fafc; --admin: #805ad5; --danger: #e53e3e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--primary); }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .section { display: none; }
        .active { display: block; }
        input, textarea, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #cbd5e0; box-sizing: border-box; }
        button { background: var(--accent); color: white; border: none; font-weight: bold; cursor: pointer; }
        button.danger { background: var(--danger); }
        button.secondary { background: #e2e8f0; color: #1a202c; }
        .admin-area { border: 2px solid var(--admin); padding: 15px; border-radius: 8px; margin-bottom: 20px; background: #faf5ff; }
        .note-card { background: #edf2f7; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid var(--accent); }
        .note-actions { display: flex; gap: 5px; margin-top: 10px; }
        .note-actions button { width: auto; padding: 5px 10px; font-size: 0.8em; }
        .secret-box { background: #fff5f5; padding: 15px; border: 1px dashed var(--danger); border-radius: 8px; margin: 15px 0; }
    </style>
</head>
<body>

<div class="container">
    <h1>PrivateVault</h1>

    <div id="login-sec" class="section active">
        <h2>Login</h2>
        <input type="text" id="login-user" placeholder="Username">
        <div style="position:relative">
            <input type="password" id="login-pass" placeholder="Password">
            <small style="cursor:pointer; color:blue" onclick="togglePass('login-pass')">Show/Hide Password</small>
        </div>
        <button onclick="handleLogin()">Login</button>
        <button class="secondary" onclick="showSection('reg-sec')">Register</button>
    </div>

    <div id="reg-sec" class="section">
        <h2>Register</h2>
        <input type="text" id="reg-user" placeholder="Username">
        <input type="password" id="reg-pass" placeholder="Password">
        <input type="text" id="reg-secret" placeholder="Personal Secret">
        <button onclick="handleRegister()">Create Account</button>
        <button class="secondary" onclick="showSection('login-sec')">Back</button>
    </div>

    <div id="verify-sec" class="section">
        <h2>Family Access Code</h2>
        <input type="text" id="verify-code-input" placeholder="Enter the complex code">
        <button onclick="confirmFamilyCode()">Verify</button>
    </div>

    <div id="vault-sec" class="section">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h2 id="welcome-msg">Vault</h2>
            <button onclick="logout()" style="width:auto;" class="danger">Logout</button>
        </div>

        <div id="admin-panel" style="display:none" class="admin-area">
            <h3 style="color:var(--admin); margin:0">Admin Control</h3>
            <p>Code: <code id="current-code-text"></code></p>
            <button onclick="generateComplexCode()" style="background:var(--admin)">New Code</button>
            <hr>
            <div id="admin-user-list"></div>
        </div>

        <div class="secret-box">
            <h3>My Personal Secret</h3>
            <p id="my-stored-secret" style="font-weight:bold"></p>
            <button class="secondary" style="width:auto; padding:5px" onclick="editMySecret()">Edit Secret</button>
        </div>

        <div id="notes-area">
            <h3>My Notes & Sites</h3>
            <input type="text" id="note-title" placeholder="Title">
            <textarea id="note-content" placeholder="Content..."></textarea>
            <button onclick="addNote()">Save Note</button>
            <div id="my-notes-list"></div>
        </div>
    </div>
</div>

<script>
    let users = JSON.parse(localStorage.getItem('pv_users')) || {};
    let sys = JSON.parse(localStorage.getItem('pv_sys')) || { code: "", expiry: 0 };
    let currentUser = localStorage.getItem('pv_session_user');
    let hasVerifiedCode = sessionStorage.getItem('pv_verified') === 'true';

    function save() { localStorage.setItem('pv_users', JSON.stringify(users)); }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function togglePass(id) {
        const x = document.getElementById(id);
        x.type = x.type === "password" ? "text" : "password";
    }

    function handleRegister() {
        const u = document.getElementById('reg-user').value.trim();
        const p = document.getElementById('reg-pass').value;
        const s = document.getElementById('reg-secret').value;
        if(!u || !p || !s) return alert("Fill all fields");
        const isAdmin = Object.keys(users).length === 0;
        users[u] = { password: p, personalSecret: s, isAdmin, notes: [] };
        save();
        showSection('login-sec');
    }

    function handleLogin() {
        const u = document.getElementById('login-user').value.trim();
        const p = document.getElementById('login-pass').value;
        if(users[u] && users[u].password === p) {
            currentUser = u;
            localStorage.setItem('pv_session_user', u);
            if(users[u].isAdmin) { if(!sys.code) generateComplexCode(); openVault(); }
            else { showSection('verify-sec'); }
        } else { alert("Wrong password or user not found."); }
    }

    function confirmFamilyCode() {
        if(document.getElementById('verify-code-input').value === sys.code) {
            hasVerifiedCode = true;
            sessionStorage.setItem('pv_verified', 'true');
            openVault();
        } else { alert("Invalid Code"); }
    }

    function openVault() {
        showSection('vault-sec');
        document.getElementById('welcome-msg').innerText = "Hello, " + currentUser;
        document.getElementById('my-stored-secret').innerText = users[currentUser].personalSecret;
        if(users[currentUser].isAdmin) {
            document.getElementById('admin-panel').style.display = 'block';
            renderAdmin();
        }
        renderNotes();
    }

    function generateComplexCode() {
        const c = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()";
        let code = "";
        for (let i = 0; i < 12; i++) code += c.charAt(Math.floor(Math.random() * c.length));
        sys.code = code;
        localStorage.setItem('pv_sys', JSON.stringify(sys));
        renderAdmin();
    }

    function renderAdmin() {
        document.getElementById('current-code-text').innerText = sys.code;
        const list = document.getElementById('admin-user-list');
        list.innerHTML = "<h4>Users:</h4>";
        Object.keys(users).forEach(u => {
            list.innerHTML += `<p>${u} (${users[u].personalSecret}) <button onclick="deleteUser('${u}')" style="width:auto; padding:2px; background:red; font-size:10px;">Delete</button></p>`;
        });
    }

    function deleteUser(u) { if(confirm("Delete " + u + "?")) { delete users[u]; save(); renderAdmin(); } }

    function editMySecret() {
        const n = prompt("New secret:", users[currentUser].personalSecret);
        if(n) { users[currentUser].personalSecret = n; save(); openVault(); }
    }

    function addNote() {
        const t = document.getElementById('note-title').value;
        const c = document.getElementById('note-content').value;
        if(!t) return;
        users[currentUser].notes.push({t, c, id: Date.now()});
        save(); renderNotes();
        document.getElementById('note-title').value = ""; document.getElementById('note-content').value = "";
    }

    function renderNotes() {
        const div = document.getElementById('my-notes-list');
        div.innerHTML = "";
        users[currentUser].notes.forEach(n => {
            div.innerHTML += `
                <div class="note-card">
                    <strong>${n.t}</strong>
                    <p>${n.c}</p>
                    <div class="note-actions">
                        <button class="secondary" onclick="editNote(${n.id})">Edit</button>
                        <button class="danger" onclick="deleteNote(${n.id})">Delete</button>
                    </div>
                </div>`;
        });
    }

    function deleteNote(id) {
        users[currentUser].notes = users[currentUser].notes.filter(n => n.id !== id);
        save(); renderNotes();
    }

    function editNote(id) {
        const note = users[currentUser].notes.find(n => n.id === id);
        const nt = prompt("Edit Title:", note.t);
        const nc = prompt("Edit Content:", note.c);
        if(nt !== null) note.t = nt;
        if(nc !== null) note.c = nc;
        save(); renderNotes();
    }

    function logout() { localStorage.removeItem('pv_session_user'); sessionStorage.removeItem('pv_verified'); location.reload(); }

    if(currentUser) openVault();
</script>
</body>
</html>
